<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brand Assets - Brand Central</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Manrope', sans-serif;
            background: #1F1633;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(63, 203, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(63, 203, 255, 0.05) 0%, transparent 50%);
            color: #FFFFFF;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Navigation */
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(31, 22, 51, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 15px 0;
            transition: all 0.3s ease;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 20px;
            font-weight: 700;
            color: #3FCBFF;
            text-decoration: none;
        }

        .logo img {
            height: 28px;
            margin-right: 8px;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 25px;
            align-items: center;
        }

        .nav-links a {
            color: #FFFFFF;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
            position: relative;
            font-size: 14px;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: #3FCBFF;
        }

        .auth-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-email {
            color: #3FCBFF;
            font-weight: 500;
        }

        /* Main Content */
        .main-content {
            margin-top: 80px;
            padding: 40px 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title {
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #3FCBFF, #FFFFFF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            font-size: 1.2em;
            color: rgba(255, 255, 255, 0.8);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Admin Section */
        .admin-section {
            background: rgba(63, 203, 255, 0.1);
            border: 1px solid rgba(63, 203, 255, 0.3);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            display: none;
        }

        .admin-section h3 {
            color: #3FCBFF;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .upload-area {
            border: 2px dashed rgba(63, 203, 255, 0.5);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 1rem 0;
            background: rgba(63, 203, 255, 0.05);
        }

        .upload-area:hover {
            border-color: #3FCBFF;
            background: rgba(63, 203, 255, 0.1);
        }

        .upload-area h4 {
            color: #3FCBFF;
            margin-bottom: 0.5rem;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .search-filter {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            flex: 1;
        }

        .search-box {
            padding: 12px 16px;
            border: 2px solid rgba(63, 203, 255, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            min-width: 250px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-family: 'Manrope', sans-serif;
            transition: border-color 0.3s;
        }

        .search-box::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .search-box:focus {
            outline: none;
            border-color: #3FCBFF;
            background: rgba(255, 255, 255, 0.15);
        }

        .filter-select {
            padding: 12px 16px;
            border: 2px solid rgba(63, 203, 255, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            min-width: 150px;
            font-family: 'Manrope', sans-serif;
        }

        .filter-select option {
            background: #1F1633;
            color: white;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Manrope', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3FCBFF, #2196F3);
            color: white;
            border: 2px solid transparent;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(63, 203, 255, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: #3FCBFF;
            border: 2px solid #3FCBFF;
        }

        .btn-secondary:hover {
            background: #3FCBFF;
            color: #1F1633;
        }

        .btn-danger {
            background: #ff4757;
            color: white;
            border: 2px solid transparent;
        }

        .btn-danger:hover {
            background: #ff3742;
            transform: translateY(-2px);
        }

        /* Assets Grid */
        .assets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .asset-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(63, 203, 255, 0.2);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .asset-card:hover {
            transform: translateY(-5px);
            border-color: #3FCBFF;
            box-shadow: 0 10px 30px rgba(63, 203, 255, 0.2);
        }

        .asset-preview {
            width: 100%;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .asset-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
        }

        .asset-info {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            height: calc(100% - 200px); /* Account for preview height */
        }

        .asset-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #3FCBFF;
        }

        .asset-description {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .asset-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tag {
            background: rgba(63, 203, 255, 0.2);
            color: #3FCBFF;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            border: 1px solid rgba(63, 203, 255, 0.3);
        }

        .asset-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: auto; /* Push buttons to bottom of card */
        }

        .asset-actions .btn {
            flex: 1;
            min-width: fit-content;
            padding: 8px 12px;
            font-size: 0.9rem;
            justify-content: center;
        }

        .asset-actions .btn-primary {
            flex: 2; /* Make download button bigger */
            font-weight: 700;
        }

        /* Loading and Status */
        .loading {
            text-align: center;
            padding: 3rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #3FCBFF;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-message {
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            font-weight: 500;
        }

        .status-success {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .status-error {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .status-info {
            background: rgba(63, 203, 255, 0.2);
            color: #3FCBFF;
            border: 1px solid rgba(63, 203, 255, 0.3);
        }

        .debug-info {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #1F1633;
            border: 1px solid rgba(63, 203, 255, 0.3);
            border-radius: 15px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            color: #3FCBFF;
            margin-bottom: 1rem;
        }

        .modal-content input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(63, 203, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-family: 'Manrope', sans-serif;
            margin-bottom: 1rem;
        }

        .modal-content input:focus {
            outline: none;
            border-color: #3FCBFF;
        }

        .modal-content label {
            display: block;
            margin-bottom: 0.5rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
        }

        .hidden {
            display: none !important;
        }

        /* Tag Management Modal */
        .tag-management-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .tag-management-content {
            background: linear-gradient(135deg, #1F1633 0%, #3F105E 100%);
            border: 2px solid rgba(63, 203, 255, 0.3);
            border-radius: 15px;
            padding: 2rem;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .tag-management-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .tag-management-title {
            color: #3FCBFF;
            font-size: 1.5rem;
            margin: 0;
        }

        .close-tag-modal {
            background: none;
            border: none;
            color: #FFFFFF;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .close-tag-modal:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .tag-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .tag-form h3 {
            color: #3FCBFF;
            margin-bottom: 1rem;
        }

        .tag-form-row {
            display: flex;
            gap: 1rem;
            align-items: end;
        }

        .tag-form-field {
            flex: 1;
        }

        .tag-form input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(63, 203, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-family: 'Manrope', sans-serif;
        }

        .tag-form input:focus {
            outline: none;
            border-color: #3FCBFF;
        }

        .tag-list {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1.5rem;
        }

        .tag-list h3 {
            color: #3FCBFF;
            margin-bottom: 1rem;
        }

        .tag-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid rgba(63, 203, 255, 0.2);
        }

        .tag-item:last-child {
            margin-bottom: 0;
        }

        .tag-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .tag-name {
            font-weight: 600;
            color: #FFFFFF;
            margin-bottom: 4px;
        }

        .tag-description {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .tag-actions {
            display: flex;
            gap: 10px;
        }

        .tag-usage-count {
            background: rgba(63, 203, 255, 0.2);
            color: #3FCBFF;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .no-tags-message {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            padding: 2rem;
            font-style: italic;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
            min-width: auto;
        }

        /* Asset Tag Editor Modal */
        .asset-tag-editor-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1002;
        }

        .asset-tag-editor-content {
            background: linear-gradient(135deg, #1F1633 0%, #3F105E 100%);
            border: 2px solid rgba(63, 203, 255, 0.3);
            border-radius: 15px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .asset-tag-editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .asset-tag-editor-title {
            color: #3FCBFF;
            font-size: 1.3rem;
            margin: 0;
        }

        .close-tag-editor {
            background: none;
            border: none;
            color: #FFFFFF;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .close-tag-editor:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .asset-info-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .asset-info-name {
            color: #3FCBFF;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .current-tags-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .current-tags-section h4 {
            color: #3FCBFF;
            margin-bottom: 1rem;
        }

        .current-tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 1rem;
        }

        .current-tag {
            background: rgba(63, 203, 255, 0.2);
            color: #3FCBFF;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .remove-tag-btn {
            background: none;
            border: none;
            color: #3FCBFF;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
        }

        .remove-tag-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .add-tags-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1.5rem;
        }

        .add-tags-section h4 {
            color: #3FCBFF;
            margin-bottom: 1rem;
        }

        .available-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 1rem;
        }

        .available-tag {
            background: rgba(255, 255, 255, 0.1);
            color: #FFFFFF;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .available-tag:hover {
            background: rgba(63, 203, 255, 0.3);
            border-color: #3FCBFF;
            color: #3FCBFF;
        }

        .available-tag.selected {
            background: rgba(63, 203, 255, 0.2);
            border-color: #3FCBFF;
            color: #3FCBFF;
        }

        .tag-actions-section {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .no-tags-available {
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            text-align: center;
            padding: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-title {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-filter {
                flex-direction: column;
            }
            
            .search-box, .filter-select {
                min-width: unset;
                width: 100%;
            }
            
            .assets-grid {
                grid-template-columns: 1fr;
            }

            .nav-links {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <img src="assets/logos/icon-only.png" alt="Paradigm Logo" onerror="this.style.display='none'">
                Brand Central
            </a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="assets.html" class="active">Assets</a></li>
                <li><a href="guidelines.html">Guidelines</a></li>
                <li><a href="resources.html">Resources</a></li>
                <li><a href="templates.html">Templates</a></li>
            </ul>
            <div class="auth-section">
                <span id="userEmail" class="user-email"></span>
                <button id="authButton" class="btn btn-primary" onclick="toggleAuth()">Sign In</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <div class="page-header">
                <h1 class="page-title">Brand Assets</h1>
                <p class="page-subtitle">Discover, download, and manage brand assets with ease</p>
            </div>

            <!-- Admin Section -->
            <div id="adminSection" class="admin-section">
                <h3>üîß Admin Tools</h3>
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <h4>üìÅ Upload New Asset</h4>
                    <p>Click here or drag and drop files to upload</p>
                    <input type="file" id="fileInput" multiple accept="image/*,video/*,application/pdf,application/zip" style="display: none;">
                </div>
                <div style="margin-top: 1rem;">
                    <button class="btn btn-secondary" onclick="showManageTags()">üè∑Ô∏è Manage Tags</button>
                    <button class="btn btn-secondary" onclick="refreshAssets()">üîÑ Refresh Assets</button>
                    <button class="btn btn-secondary" onclick="testUploadFunction()">üß™ Test Upload</button>
                    <button class="btn btn-secondary" onclick="addTestAssets()">‚ûï Add Test Assets</button>
                    <button class="btn btn-secondary" onclick="toggleDebugInfo()">üîç Toggle Debug</button>
                </div>
            </div>

            <!-- Search and Filter Controls -->
            <div class="controls">
                <div class="search-filter">
                    <input type="text" id="searchBox" class="search-box" placeholder="üîç Search assets...">
                    <select id="categoryFilter" class="filter-select">
                        <option value="">All Categories</option>
                    </select>
                    <select id="tagFilter" class="filter-select">
                        <option value="">All Tags</option>
                    </select>
                </div>
            </div>

            <!-- Status Messages -->
            <div id="statusContainer"></div>

            <!-- Debug Information - Hidden by default -->
            <div id="debugInfo" class="debug-info hidden">
                <strong>üîç Debug Information:</strong><br>
                <span id="debugContent">Initializing Supabase connection...</span>
            </div>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="loading">
                <div class="spinner"></div>
                Loading assets...
            </div>

            <!-- Assets Grid -->
            <div id="assetsContainer" class="assets-grid"></div>

            <!-- No Assets Message -->
            <div id="noAssetsMessage" class="loading hidden">
                <h3>üìÇ No assets found</h3>
                <p>No assets match your current search criteria.</p>
            </div>
        </div>
    </div>

    <!-- Asset Tag Editor Modal -->
    <div id="assetTagEditorModal" class="asset-tag-editor-modal hidden">
        <div class="asset-tag-editor-content">
            <div class="asset-tag-editor-header">
                <h3 class="asset-tag-editor-title">üè∑Ô∏è Edit Asset Tags</h3>
                <button class="close-tag-editor" onclick="closeAssetTagEditor()">&times;</button>
            </div>

            <div class="asset-info-section">
                <div class="asset-info-name" id="editingAssetName">Asset Name</div>
            </div>

            <div class="current-tags-section">
                <h4>Current Tags</h4>
                <div class="current-tags-list" id="currentTagsList">
                    <!-- Current tags will be populated here -->
                </div>
                <div id="noCurrentTags" class="no-tags-available" style="display: none;">
                    No tags assigned to this asset
                </div>
            </div>

            <div class="add-tags-section">
                <h4>Available Tags</h4>
                <div class="available-tags" id="availableTagsList">
                    <!-- Available tags will be populated here -->
                </div>
                <div id="noAvailableTags" class="no-tags-available" style="display: none;">
                    No tags available. Create tags in Tag Management first.
                </div>
            </div>

            <div class="tag-actions-section">
                <button class="btn btn-secondary" onclick="closeAssetTagEditor()">Cancel</button>
                <button class="btn btn-primary" onclick="saveAssetTags()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Tag Management Modal -->
    <div id="tagManagementModal" class="tag-management-modal hidden">
        <div class="tag-management-content">
            <div class="tag-management-header">
                <h2 class="tag-management-title">üè∑Ô∏è Manage Tags</h2>
                <button class="close-tag-modal" onclick="closeTagManagement()">&times;</button>
            </div>

            <!-- Add New Tag Form -->
            <div class="tag-form">
                <h3>Add New Tag</h3>
                <form id="addTagForm">
                    <div class="tag-form-row">
                        <div class="tag-form-field">
                            <label for="tagName">Tag Name</label>
                            <input type="text" id="tagName" placeholder="Enter tag name" required>
                        </div>
                        <div class="tag-form-field">
                            <label for="tagDescription">Description (Optional)</label>
                            <input type="text" id="tagDescription" placeholder="Enter description">
                        </div>
                        <div>
                            <button type="submit" class="btn btn-primary">Add Tag</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Existing Tags List -->
            <div class="tag-list">
                <h3>Existing Tags</h3>
                <div id="tagsList">
                    <div class="no-tags-message">Loading tags...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase JS -->
    <script 
        src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" 
        onerror="console.error('Failed to load Supabase library'); document.getElementById('debugContent').innerHTML += '<br>‚ùå Failed to load Supabase library from CDN'"
        onload="console.log('Supabase library loaded successfully'); document.getElementById('debugContent').innerHTML += '<br>‚úÖ Supabase library loaded from CDN'">
    </script>
    
    <script>
        // üîß SUPABASE CONFIGURATION
        const SUPABASE_URL = 'https://gijhfdjsmlgivjhvbtve.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpamhmZGpzbWxnaXZqaHZidHZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5NTE3ODMsImV4cCI6MjA2ODUyNzc4M30.HWAjtnUIsAa8swRgtIcMz9z-Ll8N4PmqWas1DF2fFVY';
        
        // Initialize Supabase client
        let supabase;
        let currentUser = null;
        let isAdmin = false;
        let allAssets = [];
        let allTags = [];

        // üöÄ INITIALIZE APPLICATION
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Supabase Brand Assets initializing...');
            updateDebugInfo('üöÄ Initializing Supabase connection...');
            
            try {
                // Wait for Supabase library to load
                await waitForSupabaseLibrary();
                
                // Initialize Supabase client
                await initializeSupabase();
                
                // Setup event listeners first
                setupEventListeners();
                
                // Check authentication state
                await checkAuthState();
                
                // Load data
                await loadTags();
                await loadAssets();
                
                // Test storage connectivity if user is admin
                if (isAdmin) {
                    setTimeout(() => testStorageConnectivity(), 1000);
                }
                
                console.log('‚úÖ Application initialized successfully');
                updateDebugInfo('‚úÖ Application initialized successfully');
                
            } catch (error) {
                console.error('‚ùå Initialization error:', error);
                updateDebugInfo(`‚ùå Initialization Error: ${error.message}`);
                showStatus('Failed to initialize application: ' + error.message, 'error');
            }
        });

        // Wait for Supabase library to load
        function waitForSupabaseLibrary() {
            return new Promise((resolve, reject) => {
                let attempts = 0;
                const maxAttempts = 20; // Wait up to 10 seconds
                
                const checkLibrary = () => {
                    if (typeof window.supabase !== 'undefined') {
                        updateDebugInfo('‚úÖ Supabase library loaded');
                        resolve();
                    } else if (attempts >= maxAttempts) {
                        updateDebugInfo('‚ùå Supabase library failed to load');
                        reject(new Error('Supabase library failed to load. Please check your internet connection.'));
                    } else {
                        attempts++;
                        updateDebugInfo(`üîÑ Waiting for Supabase library... (${attempts}/${maxAttempts})`);
                        setTimeout(checkLibrary, 500);
                    }
                };
                
                checkLibrary();
            });
        }

        // Initialize Supabase
        async function initializeSupabase() {
            try {
                if (SUPABASE_URL === 'YOUR_SUPABASE_URL') {
                    throw new Error('Please configure your Supabase URL and anon key');
                }
                
                // Wait for Supabase library to load
                if (typeof window.supabase === 'undefined') {
                    throw new Error('Supabase library not loaded. Please check your internet connection.');
                }
                
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                
                updateDebugInfo('‚úÖ Supabase: Connected successfully');
                console.log('‚úÖ Supabase client initialized');
                
                // Test basic connection with a simple query
                try {
                    const { data, error } = await supabase.from('profiles').select('count').limit(1);
                    if (error) {
                        console.error('Database connection test failed:', error);
                        updateDebugInfo(`‚ö†Ô∏è Database: Connection test failed - ${error.message}`);
                        // Continue anyway, as the table might not exist yet
                    } else {
                        updateDebugInfo('‚úÖ Database: Connection verified');
                    }
                } catch (testError) {
                    console.error('Database test error:', testError);
                    updateDebugInfo(`‚ö†Ô∏è Database test failed: ${testError.message}`);
                }
                
            } catch (error) {
                console.error('‚ùå Supabase initialization error:', error);
                updateDebugInfo(`‚ùå Supabase Error: ${error.message}`);
                showStatus('Failed to connect to Supabase. Please check configuration.', 'error');
            }
        }

        // Check authentication state
        async function checkAuthState() {
            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) {
                    throw error;
                }
                
                if (session) {
                    currentUser = session.user;
                    await checkAdminStatus();
                    updateAuthUI();
                } else {
                    updateAuthUI();
                }
                
                // Listen for auth changes
                supabase.auth.onAuthStateChange(async (event, session) => {
                    console.log('Auth state changed:', event);
                    if (session) {
                        currentUser = session.user;
                        await checkAdminStatus();
                    } else {
                        currentUser = null;
                        isAdmin = false;
                    }
                    updateAuthUI();
                });
                
            } catch (error) {
                console.error('‚ùå Auth state check error:', error);
                updateDebugInfo(`‚ùå Auth Error: ${error.message}`);
            }
        }

        // Check if user is admin
        async function checkAdminStatus() {
            if (!currentUser) {
                isAdmin = false;
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('profiles')
                    .select('is_admin')
                    .eq('id', currentUser.id)
                    .single();
                
                if (error) {
                    console.log('Profile not found, creating...');
                    // Profile might not exist yet, create it
                    const { data: newProfile, error: createError } = await supabase
                        .from('profiles')
                        .insert({
                            id: currentUser.id,
                            email: currentUser.email,
                            is_admin: currentUser.email === 'jrocchetti@paradigmproductionsgroup.com'
                        })
                        .select()
                        .single();
                    
                    if (createError) {
                        throw createError;
                    }
                    isAdmin = newProfile.is_admin;
                } else {
                    isAdmin = data.is_admin;
                }
                
                console.log(`User admin status: ${isAdmin}`);
                updateDebugInfo(`üîê User: ${currentUser.email}, Admin: ${isAdmin ? 'Yes' : 'No'}`);
                
            } catch (error) {
                console.error('‚ùå Admin check error:', error);
                isAdmin = false;
            }
        }

        // Update authentication UI
        function updateAuthUI() {
            const userEmail = document.getElementById('userEmail');
            const authButton = document.getElementById('authButton');
            const adminSection = document.getElementById('adminSection');
            const debugInfo = document.getElementById('debugInfo');
            
            if (currentUser) {
                userEmail.textContent = currentUser.email;
                authButton.textContent = 'Sign Out';
                authButton.onclick = signOut;
                
                if (isAdmin) {
                    adminSection.style.display = 'block';
                    // Show debug info for admin users
                    if (debugInfo) {
                        debugInfo.classList.remove('hidden');
                    }
                } else {
                    // Hide debug info for non-admin users
                    if (debugInfo) {
                        debugInfo.classList.add('hidden');
                    }
                }
            } else {
                userEmail.textContent = '';
                authButton.textContent = 'Sign In';
                authButton.onclick = showSignInModal;
                adminSection.style.display = 'none';
                // Hide debug info for non-authenticated users
                if (debugInfo) {
                    debugInfo.classList.add('hidden');
                }
            }
        }

        // Show sign-in modal
        function showSignInModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>üîê Sign In</h2>
                    <form id="signInForm" style="margin-top: 1rem;">
                        <div style="margin-bottom: 1rem;">
                            <label>Email:</label>
                            <input type="email" id="signInEmail" required>
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <label>Password:</label>
                            <input type="password" id="signInPassword" required>
                        </div>
                        <div style="display: flex; gap: 1rem;">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">Sign In</button>
                            <button type="button" class="btn btn-secondary" onclick="closeModal()" style="flex: 1;">Cancel</button>
                        </div>
                    </form>
                    <div id="signInError" style="margin-top: 1rem; color: #e74c3c; display: none;"></div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('signInForm').onsubmit = async (e) => {
                e.preventDefault();
                const email = document.getElementById('signInEmail').value;
                const password = document.getElementById('signInPassword').value;
                await signIn(email, password);
            };
            
            // Close modal on outside click
            modal.onclick = (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            };
        }

        // Sign in user
        async function signIn(email, password) {
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) {
                    throw error;
                }
                
                showStatus('Successfully signed in!', 'success');
                closeModal();
                
            } catch (error) {
                console.error('‚ùå Sign in error:', error);
                const errorDiv = document.getElementById('signInError');
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
            }
        }

        // Sign out user
        async function signOut() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) {
                    throw error;
                }
                showStatus('Successfully signed out!', 'success');
            } catch (error) {
                console.error('‚ùå Sign out error:', error);
                showStatus('Error signing out: ' + error.message, 'error');
            }
        }

        // Close modal
        function closeModal() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => modal.remove());
        }

        // Load tags from database
        async function loadTags() {
            try {
                const { data, error } = await supabase
                    .from('asset_tags')
                    .select('*')
                    .order('name');
                
                if (error) {
                    throw error;
                }
                
                allTags = data || [];
                populateTagFilter();
                console.log(`‚úÖ Loaded ${allTags.length} tags`);
                
            } catch (error) {
                console.error('‚ùå Error loading tags:', error);
                showStatus('Error loading tags: ' + error.message, 'error');
            }
        }

        // Load assets from database
        async function loadAssets() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const assetsContainer = document.getElementById('assetsContainer');
            const noAssetsMessage = document.getElementById('noAssetsMessage');
            
            try {
                console.log('üìä Loading assets from database...');
                updateDebugInfo('üìä Loading assets...');
                
                if (loadingIndicator) {
                    loadingIndicator.style.display = 'block';
                }
                
                if (assetsContainer) {
                    assetsContainer.innerHTML = '';
                }
                
                if (noAssetsMessage) {
                    noAssetsMessage.classList.add('hidden');
                }
                
                // Check if supabase is initialized
                if (!supabase) {
                    throw new Error('Supabase client not initialized');
                }
                
                console.log('üîç Querying assets table...');
                updateDebugInfo('üîç Querying assets table...');
                
                const { data, error } = await supabase
                    .from('assets')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('‚ùå Database query error:', error);
                    console.error('Error details:', {
                        message: error.message,
                        details: error.details,
                        hint: error.hint,
                        code: error.code
                    });
                    updateDebugInfo(`‚ùå Database Error: ${error.message} (Code: ${error.code})`);
                    throw error;
                }
                
                allAssets = data || [];
                console.log(`üìä Retrieved ${allAssets.length} assets from database`);
                console.log('Asset data sample:', allAssets.slice(0, 2));
                
                displayAssets(allAssets);
                
                console.log(`‚úÖ Loaded ${allAssets.length} assets`);
                updateDebugInfo(`üìä Assets: ${allAssets.length} total`);
                
            } catch (error) {
                console.error('‚ùå Error loading assets:', error);
                showStatus('Error loading assets: ' + error.message, 'error');
                updateDebugInfo(`‚ùå Asset Load Error: ${error.message}`);
                
                // Show no assets message on error
                if (assetsContainer) {
                    assetsContainer.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #e74c3c;">
                            <h3>‚ö†Ô∏è Error Loading Assets</h3>
                            <p>${error.message}</p>
                            <button class="btn btn-primary" onclick="loadAssets()">üîÑ Try Again</button>
                        </div>
                    `;
                }
            } finally {
                if (loadingIndicator) {
                    loadingIndicator.style.display = 'none';
                }
            }
        }

        // Display assets in grid
        function displayAssets(assets) {
            const assetsContainer = document.getElementById('assetsContainer');
            const noAssetsMessage = document.getElementById('noAssetsMessage');
            
            if (assets.length === 0) {
                assetsContainer.innerHTML = '';
                noAssetsMessage.classList.remove('hidden');
                return;
            }
            
            noAssetsMessage.classList.add('hidden');
            
            assetsContainer.innerHTML = assets.map(asset => `
                <div class="asset-card">
                    <div class="asset-preview">
                        ${getAssetPreview(asset)}
                    </div>
                    <div class="asset-info">
                        <div class="asset-name">${escapeHtml(asset.name)}</div>
                        ${asset.description ? `<div class="asset-description">${escapeHtml(asset.description)}</div>` : ''}
                        <div class="asset-tags">
                            ${(asset.tags || []).map(tag => `<span class="tag">${escapeHtml(tag)}</span>`).join('')}
                        </div>
                        <div class="asset-actions">
                            <button class="btn btn-primary" onclick="downloadAsset('${asset.file_url}', '${escapeHtml(asset.name)}')">
                                üì• Download
                            </button>
                            <button class="btn btn-secondary" onclick="copyAssetUrl('${asset.file_url}')" title="Copy file URL">
                                üîó Copy Link
                            </button>
                            <button class="btn btn-secondary" onclick="openAssetInNewTab('${asset.file_url}')" title="Open in new tab">
                                üìÇ Open
                            </button>
                            ${isAdmin ? `
                                <button class="btn btn-secondary" onclick="editAssetTags('${asset.id}', '${escapeHtml(asset.name)}')" title="Edit tags">
                                    üè∑Ô∏è Edit Tags
                                </button>
                                <button class="btn btn-danger" onclick="deleteAsset('${asset.id}')">
                                    üóëÔ∏è Delete
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Get asset preview based on type
        function getAssetPreview(asset) {
            if (asset.mime_type && asset.mime_type.startsWith('image/')) {
                return `<img src="${asset.file_url}" alt="${escapeHtml(asset.name)}" loading="lazy">`;
            } else if (asset.mime_type && asset.mime_type.startsWith('video/')) {
                return `<video src="${asset.file_url}" controls style="max-width: 100%; max-height: 100%;"></video>`;
            } else {
                const icon = getFileIcon(asset.mime_type);
                return `<div style="font-size: 3rem;">${icon}</div>`;
            }
        }

        // Get file icon based on mime type
        function getFileIcon(mimeType) {
            if (!mimeType) return 'üìÑ';
            if (mimeType.includes('pdf')) return 'üìÑ';
            if (mimeType.includes('zip')) return 'üì¶';
            if (mimeType.includes('video')) return 'üé•';
            if (mimeType.includes('audio')) return 'üéµ';
            return 'üìÑ';
        }

        // Download asset
        async function downloadAsset(url, filename) {
            try {
                showStatus(`üì• Preparing download for ${filename}...`, 'info');
                
                // Method 1: Try Supabase signed URL for better download support
                try {
                    // Extract file path from URL for Supabase storage
                    const urlParts = url.split('/storage/v1/object/public/assets/');
                    if (urlParts.length > 1) {
                        const filePath = urlParts[1];
                        
                        // Get a signed URL with download transformation
                        const { data: signedUrlData, error: signedUrlError } = await supabase.storage
                            .from('assets')
                            .createSignedUrl(filePath, 3600, {
                                download: filename
                            });
                            
                        if (!signedUrlError && signedUrlData?.signedUrl) {
                            console.log('‚úÖ Using Supabase signed URL for download');
                            
                            // Use the signed URL which should force download
                            const link = document.createElement('a');
                            link.href = signedUrlData.signedUrl;
                            link.download = filename;
                            link.style.display = 'none';
                            
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            
                            showStatus(`‚úÖ Download started: ${filename}`, 'success');
                            return;
                        } else {
                            console.log('Signed URL failed, trying fetch method:', signedUrlError);
                        }
                    }
                } catch (signedUrlError) {
                    console.log('Signed URL method failed, trying fetch:', signedUrlError);
                }
                
                // Method 2: Try fetch with blob conversion (fallback)
                try {
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const blob = await response.blob();
                    
                    // Create blob URL for download
                    const blobUrl = window.URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = blobUrl;
                    link.download = filename;
                    link.style.display = 'none';
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // Clean up blob URL
                    setTimeout(() => window.URL.revokeObjectURL(blobUrl), 1000);
                    
                    showStatus(`‚úÖ Download started: ${filename}`, 'success');
                    return;
                    
                } catch (fetchError) {
                    console.log('Fetch method failed, trying fallback:', fetchError);
                    
                    // Method 2: Fallback to direct link (for same-origin or properly configured files)
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = filename;
                    link.target = '_blank'; // Open in new tab if download fails
                    link.style.display = 'none';
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showStatus(`üìé Download link opened: ${filename}`, 'info');
                }
                
            } catch (error) {
                console.error('‚ùå Download error:', error);
                showStatus(`‚ùå Download failed: ${error.message}`, 'error');
                
                // Final fallback: open in new window
                try {
                    window.open(url, '_blank');
                    showStatus('üìÇ File opened in new tab', 'info');
                } catch (openError) {
                    showStatus('‚ùå Unable to access file', 'error');
                }
            }
        }

        // Copy asset URL to clipboard
        async function copyAssetUrl(url) {
            try {
                await navigator.clipboard.writeText(url);
                showStatus('üîó Asset URL copied to clipboard', 'success');
            } catch (error) {
                console.error('Failed to copy URL:', error);
                showStatus('‚ùå Failed to copy URL', 'error');
            }
        }

        // Open asset in new tab
        function openAssetInNewTab(url) {
            try {
                window.open(url, '_blank');
                showStatus('üìÇ Asset opened in new tab', 'info');
            } catch (error) {
                console.error('Failed to open asset:', error);
                showStatus('‚ùå Failed to open asset', 'error');
            }
        }

        // Populate tag filter dropdown
        function populateTagFilter() {
            const tagFilter = document.getElementById('tagFilter');
            tagFilter.innerHTML = '<option value="">All Tags</option>';
            
            allTags.forEach(tag => {
                const option = document.createElement('option');
                option.value = tag.name;
                option.textContent = tag.name;
                tagFilter.appendChild(option);
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            const searchBox = document.getElementById('searchBox');
            const categoryFilter = document.getElementById('categoryFilter');
            const tagFilter = document.getElementById('tagFilter');
            
            searchBox.addEventListener('input', filterAssets);
            categoryFilter.addEventListener('change', filterAssets);
            tagFilter.addEventListener('change', filterAssets);
            
            // File input change handler
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
            
            // Setup drag and drop functionality
            setupDragAndDrop();
        }

        // Setup drag and drop functionality for upload area
        function setupDragAndDrop() {
            const uploadArea = document.querySelector('.upload-area');
            if (!uploadArea) return;
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight(e) {
                uploadArea.style.backgroundColor = 'rgba(63, 203, 255, 0.1)';
                uploadArea.style.borderColor = '#3FCBFF';
            }
            
            function unhighlight(e) {
                uploadArea.style.backgroundColor = '';
                uploadArea.style.borderColor = '';
            }
            
            uploadArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                // Create a fake event object to match the file input handler
                const fakeEvent = {
                    target: { 
                        files: files,
                        value: '' // For clearing after upload
                    }
                };
                
                handleFileUpload(fakeEvent);
            }
        }

        // Handle file upload
        async function handleFileUpload(event) {
            console.log('üîç Upload triggered:', event);
            console.log('üîç Files selected:', event.target.files.length);
            
            const files = event.target.files;
            if (!files.length) {
                console.log('‚ùå No files selected');
                return;
            }
            
            console.log('üîç Current user:', currentUser);
            console.log('üîç Is admin:', isAdmin);
            
            if (!currentUser) {
                console.log('‚ùå User not authenticated');
                showStatus('Please sign in to upload files.', 'error');
                return;
            }
            
            if (!isAdmin) {
                console.log('‚ùå User is not admin');
                showStatus('Only admins can upload files.', 'error');
                return;
            }
            
            console.log('‚úÖ Starting upload process...');
            showStatus('Uploading files...', 'info');
            
            try {
                const uploadPromises = Array.from(files).map((file, index) => {
                    console.log(`üì§ Processing file ${index + 1}:`, file.name, file.type, file.size);
                    return uploadSingleFile(file);
                });
                
                const results = await Promise.all(uploadPromises);
                console.log('‚úÖ All uploads completed:', results);
                
                showStatus(`Successfully uploaded ${files.length} file(s)!`, 'success');
                
                // Reload assets to show newly uploaded files
                await loadAssets();
                
                // Clear the file input
                event.target.value = '';
                
            } catch (error) {
                console.error('‚ùå Upload error:', error);
                console.error('‚ùå Error stack:', error.stack);
                showStatus('Upload failed: ' + error.message, 'error');
                updateDebugInfo(`‚ùå Upload Error: ${error.message}`);
            }
        }
        
        // Upload a single file to Supabase Storage and create database record
        async function uploadSingleFile(file) {
            console.log(`üì§ Starting upload for: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`);
            console.log(`üì§ File type: ${file.type}`);
            
            // Check file size (50MB limit)
            if (file.size > 50 * 1024 * 1024) {
                throw new Error(`File ${file.name} is too large. Maximum size is 50MB.`);
            }
            
            // Generate unique filename to avoid conflicts
            const fileExt = file.name.split('.').pop();
            const fileName = `${Date.now()}_${Math.random().toString(36).substring(2)}.${fileExt}`;
            const filePath = `brand-assets/${fileName}`;
            
            console.log(`üì§ Generated file path: ${filePath}`);
            
            try {
                // Upload file to Supabase Storage with download headers
                console.log('üì§ Uploading to storage...');
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('assets')
                    .upload(filePath, file, {
                        cacheControl: '3600',
                        upsert: false,
                        contentType: file.type,
                        metadata: {
                            'content-disposition': `attachment; filename="${file.name}"`
                        }
                    });
                    
                if (uploadError) {
                    console.error('‚ùå Storage upload error:', uploadError);
                    throw new Error(`Storage upload failed: ${uploadError.message}`);
                }
                
                console.log(`‚úÖ File uploaded to storage:`, uploadData);
                
                // Get public URL for the uploaded file
                console.log('üì§ Getting public URL...');
                const { data: urlData } = supabase.storage
                    .from('assets')
                    .getPublicUrl(filePath);
                    
                if (!urlData?.publicUrl) {
                    console.error('‚ùå Failed to get public URL:', urlData);
                    throw new Error('Failed to get public URL for uploaded file');
                }
                
                console.log(`‚úÖ Public URL generated: ${urlData.publicUrl}`);
                
                // Determine category based on file type
                const category = getCategoryFromMimeType(file.type);
                console.log(`üì§ Determined category: ${category}`);
                
                // Create database record
                console.log('üì§ Creating database record...');
                const assetRecord = {
                    name: file.name,
                    description: `Uploaded ${file.type} file`,
                    file_path: filePath,
                    file_url: urlData.publicUrl,
                    file_size: file.size,
                    mime_type: file.type,
                    category: category,
                    tags: [category], // Auto-tag with category
                    uploaded_by: currentUser.id
                };
                
                console.log('üì§ Asset record to insert:', assetRecord);
                
                const { data: assetData, error: dbError } = await supabase
                    .from('assets')
                    .insert([assetRecord])
                    .select()
                    .single();
                    
                if (dbError) {
                    console.error('‚ùå Database insert error:', dbError);
                    // If database insert fails, try to clean up the uploaded file
                    try {
                        console.log('üóëÔ∏è Cleaning up uploaded file...');
                        await supabase.storage.from('assets').remove([filePath]);
                    } catch (cleanupError) {
                        console.error('‚ùå Failed to cleanup uploaded file:', cleanupError);
                    }
                    throw new Error(`Database insert failed: ${dbError.message}`);
                }
                
                console.log(`‚úÖ Database record created:`, assetData);
                updateDebugInfo(`‚úÖ Uploaded: ${file.name}`);
                return assetData;
                
            } catch (error) {
                console.error(`‚ùå Upload failed for ${file.name}:`, error);
                updateDebugInfo(`‚ùå Upload failed: ${file.name} - ${error.message}`);
                throw error;
            }
        }
        
        // Determine category based on MIME type
        function getCategoryFromMimeType(mimeType) {
            if (mimeType.startsWith('image/')) {
                if (mimeType.includes('svg')) return 'logo';
                return 'image';
            }
            if (mimeType.startsWith('video/')) return 'video';
            if (mimeType.startsWith('audio/')) return 'audio';
            if (mimeType === 'application/pdf') return 'document';
            if (mimeType.includes('document') || mimeType.includes('text')) return 'document';
            if (mimeType.includes('font')) return 'font';
            return 'other';
        }

        // Get filtered assets based on current search and filter state
        function getFilteredAssets() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const tagFilter = document.getElementById('tagFilter').value;
            
            return allAssets.filter(asset => {
                const matchesSearch = !searchTerm || 
                    asset.name.toLowerCase().includes(searchTerm) ||
                    (asset.description && asset.description.toLowerCase().includes(searchTerm));
                
                const matchesCategory = !categoryFilter || asset.category === categoryFilter;
                
                const matchesTag = !tagFilter || (asset.tags && asset.tags.includes(tagFilter));
                
                return matchesSearch && matchesCategory && matchesTag;
            });
        }

        // Filter assets based on search and filters
        function filterAssets() {
            const filteredAssets = getFilteredAssets();
            displayAssets(filteredAssets);
        }

        // Refresh assets
        async function refreshAssets() {
            showStatus('üîÑ Refreshing assets...', 'info');
            await loadAssets();
            showStatus('‚úÖ Assets refreshed!', 'success');
        }

        // Test function to add sample assets (for debugging)
        async function addTestAssets() {
            if (!isAdmin) {
                console.log('‚ùå Test assets can only be added by admin users');
                return;
            }
            
            try {
                console.log('üß™ Adding test assets...');
                updateDebugInfo('üß™ Adding test assets...');
                
                const testAssets = [
                    {
                        name: 'Primary Logo',
                        description: 'Main brand logo for general use',
                        file_path: 'test/primary-logo.png',
                        file_url: './assets/logos/primary-logo.png',
                        file_size: 15000,
                        mime_type: 'image/png',
                        tags: ['logo', 'primary', 'brand'],
                        category: 'Logos'
                    },
                    {
                        name: 'Icon Only',
                        description: 'Icon version of the logo',
                        file_path: 'test/icon-only.png',
                        file_url: './assets/logos/icon-only.png',
                        file_size: 8000,
                        mime_type: 'image/png',
                        tags: ['logo', 'icon'],
                        category: 'Logos'
                    }
                ];
                
                for (const asset of testAssets) {
                    const { data, error } = await supabase
                        .from('assets')
                        .insert(asset)
                        .select()
                        .single();
                    
                    if (error) {
                        console.error('Failed to insert test asset:', error);
                    } else {
                        console.log('‚úÖ Test asset added:', data.name);
                    }
                }
                
                // Reload assets after adding test data
                await loadAssets();
                updateDebugInfo('‚úÖ Test assets added successfully');
                
            } catch (error) {
                console.error('‚ùå Error adding test assets:', error);
                updateDebugInfo(`‚ùå Test Asset Error: ${error.message}`);
            }
        }

        // Utility function to escape HTML
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Show status message
        function showStatus(message, type = 'info') {
            console.log(`üì¢ Status [${type}]: ${message}`);
            
            const container = document.getElementById('statusContainer');
            if (!container) {
                console.warn('Status container not found');
                return;
            }
            
            const statusDiv = document.createElement('div');
            statusDiv.className = `status-message status-${type}`;
            statusDiv.textContent = message;
            
            container.appendChild(statusDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.parentNode.removeChild(statusDiv);
                }
            }, 5000);
        }

        // Update debug information
        function updateDebugInfo(info) {
            // Only show debug info for admin users
            if (!isAdmin) {
                return;
            }
            
            const debugContent = document.getElementById('debugContent');
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            
            // Show debug section for admin users
            if (debugInfo) {
                debugInfo.classList.remove('hidden');
            }
            
            if (debugContent) {
                debugContent.innerHTML += `<br>[${timestamp}] ${info}`;
            }
        }

        // Toggle debug information visibility (admin only)
        function toggleDebugInfo() {
            if (!isAdmin) {
                return;
            }
            
            const debugInfo = document.getElementById('debugInfo');
            if (debugInfo) {
                debugInfo.classList.toggle('hidden');
                showStatus(debugInfo.classList.contains('hidden') ? 'Debug info hidden' : 'Debug info shown', 'info');
            }
        }

        // Test upload functionality (for debugging)
        function testUploadFunction() {
            console.log('üß™ Testing upload functionality...');
            console.log('üß™ Current user:', currentUser);
            console.log('üß™ Is admin:', isAdmin);
            console.log('üß™ Supabase client:', supabase);
            
            // Test file input click
            const fileInput = document.getElementById('fileInput');
            console.log('üß™ File input element:', fileInput);
            
            if (fileInput) {
                console.log('üß™ Triggering file input click...');
                fileInput.click();
            } else {
                console.error('‚ùå File input not found!');
                showStatus('File input element not found!', 'error');
            }
        }

        // Test storage connectivity
        async function testStorageConnectivity() {
            console.log('üß™ Testing storage connectivity...');
            updateDebugInfo('üß™ Testing storage connectivity...');
            
            try {
                // Test listing buckets
                const { data: buckets, error: bucketsError } = await supabase.storage.listBuckets();
                
                if (bucketsError) {
                    console.error('‚ùå Buckets list error:', bucketsError);
                    updateDebugInfo(`‚ùå Buckets Error: ${bucketsError.message}`);
                    return false;
                }
                
                console.log('‚úÖ Available buckets:', buckets);
                updateDebugInfo(`‚úÖ Found ${buckets.length} buckets`);
                
                // Check if assets bucket exists
                const assetsBucket = buckets.find(b => b.name === 'assets');
                if (!assetsBucket) {
                    console.error('‚ùå Assets bucket not found!');
                    updateDebugInfo('‚ùå Assets bucket not found!');
                    return false;
                }
                
                console.log('‚úÖ Assets bucket found:', assetsBucket);
                updateDebugInfo('‚úÖ Assets bucket is available');
                
                // Test listing files in bucket
                const { data: files, error: filesError } = await supabase.storage
                    .from('assets')
                    .list('brand-assets', { limit: 1 });
                    
                if (filesError) {
                    console.error('‚ùå Files list error:', filesError);
                    updateDebugInfo(`‚ùå Files List Error: ${filesError.message}`);
                    return false;
                }
                
                console.log('‚úÖ Storage listing works:', files);
                updateDebugInfo('‚úÖ Storage access verified');
                return true;
                
            } catch (error) {
                console.error('‚ùå Storage test error:', error);
                updateDebugInfo(`‚ùå Storage Test Error: ${error.message}`);
                return false;
            }
        }

        // Asset Tag Editor Functions
        let currentEditingAsset = null;
        let currentAssetTags = [];
        let selectedTagsToAdd = [];

        function editAssetTags(assetId, assetName) {
            if (!isAdmin) {
                showStatus('Access denied. Admin privileges required.', 'error');
                return;
            }

            // Find the asset
            const asset = allAssets.find(a => a.id === assetId);
            if (!asset) {
                showStatus('Asset not found.', 'error');
                return;
            }

            currentEditingAsset = asset;
            currentAssetTags = [...(asset.tags || [])];
            selectedTagsToAdd = [];

            // Update UI
            document.getElementById('editingAssetName').textContent = assetName;
            
            // Show modal
            const modal = document.getElementById('assetTagEditorModal');
            modal.classList.remove('hidden');

            // Load current and available tags
            displayCurrentAssetTags();
            displayAvailableTags();
        }

        function closeAssetTagEditor() {
            const modal = document.getElementById('assetTagEditorModal');
            modal.classList.add('hidden');
            
            // Reset state
            currentEditingAsset = null;
            currentAssetTags = [];
            selectedTagsToAdd = [];
        }

        function displayCurrentAssetTags() {
            const currentTagsList = document.getElementById('currentTagsList');
            const noCurrentTags = document.getElementById('noCurrentTags');

            if (currentAssetTags.length === 0) {
                currentTagsList.innerHTML = '';
                noCurrentTags.style.display = 'block';
                return;
            }

            noCurrentTags.style.display = 'none';
            currentTagsList.innerHTML = currentAssetTags.map(tag => `
                <div class="current-tag">
                    <span>${escapeHtml(tag)}</span>
                    <button class="remove-tag-btn" onclick="removeCurrentTag('${escapeHtml(tag)}')" title="Remove tag">
                        √ó
                    </button>
                </div>
            `).join('');
        }

        function displayAvailableTags() {
            const availableTagsList = document.getElementById('availableTagsList');
            const noAvailableTags = document.getElementById('noAvailableTags');

            // Filter out tags that are already assigned
            const availableTags = allTags.filter(tag => 
                !currentAssetTags.includes(tag.name)
            );

            if (availableTags.length === 0) {
                availableTagsList.innerHTML = '';
                noAvailableTags.style.display = 'block';
                return;
            }

            noAvailableTags.style.display = 'none';
            availableTagsList.innerHTML = availableTags.map(tag => `
                <div class="available-tag ${selectedTagsToAdd.includes(tag.name) ? 'selected' : ''}" 
                     onclick="toggleTagSelection('${escapeHtml(tag.name)}')"
                     title="${tag.description ? escapeHtml(tag.description) : 'Click to add this tag'}">
                    ${escapeHtml(tag.name)}
                </div>
            `).join('');
        }

        function removeCurrentTag(tagName) {
            // Remove from current tags
            currentAssetTags = currentAssetTags.filter(tag => tag !== tagName);
            
            // Also remove from selected tags if it was there
            selectedTagsToAdd = selectedTagsToAdd.filter(tag => tag !== tagName);
            
            // Update displays
            displayCurrentAssetTags();
            displayAvailableTags();
        }

        function toggleTagSelection(tagName) {
            if (selectedTagsToAdd.includes(tagName)) {
                // Remove from selection
                selectedTagsToAdd = selectedTagsToAdd.filter(tag => tag !== tagName);
            } else {
                // Add to selection
                selectedTagsToAdd.push(tagName);
            }

            // Update display
            displayAvailableTags();
        }

        async function saveAssetTags() {
            if (!currentEditingAsset) {
                showStatus('No asset selected for editing.', 'error');
                return;
            }

            try {
                console.log('üíæ Saving asset tags...');
                showStatus('Saving tags...', 'info');

                // Combine current tags with newly selected tags
                const finalTags = [...currentAssetTags, ...selectedTagsToAdd];
                
                // Remove duplicates (just in case)
                const uniqueTags = [...new Set(finalTags)];

                console.log('üìù Final tags for asset:', uniqueTags);

                // Update asset in database
                const { error } = await supabase
                    .from('assets')
                    .update({ tags: uniqueTags })
                    .eq('id', currentEditingAsset.id);

                if (error) {
                    throw error;
                }

                // Update local asset data
                const assetIndex = allAssets.findIndex(a => a.id === currentEditingAsset.id);
                if (assetIndex !== -1) {
                    allAssets[assetIndex].tags = uniqueTags;
                }

                console.log('‚úÖ Asset tags updated successfully');
                showStatus(`Asset tags updated successfully!`, 'success');

                // Close modal
                closeAssetTagEditor();

                // Refresh display
                const filteredAssets = getFilteredAssets();
                displayAssets(filteredAssets);

            } catch (error) {
                console.error('‚ùå Error saving asset tags:', error);
                showStatus(`Error saving tags: ${error.message}`, 'error');
            }
        }

        // Tag Management Functions
        function showManageTags() {
            if (!isAdmin) {
                showStatus('Access denied. Admin privileges required.', 'error');
                return;
            }

            const modal = document.getElementById('tagManagementModal');
            modal.classList.remove('hidden');
            
            // Load and display current tags
            loadTagsForManagement();
        }

        function closeTagManagement() {
            const modal = document.getElementById('tagManagementModal');
            modal.classList.add('hidden');
            
            // Clear form
            document.getElementById('addTagForm').reset();
        }

        async function loadTagsForManagement() {
            const tagsList = document.getElementById('tagsList');
            
            try {
                tagsList.innerHTML = '<div class="no-tags-message">Loading tags...</div>';
                
                // Get all tags
                const { data: tags, error: tagsError } = await supabase
                    .from('asset_tags')
                    .select('*')
                    .order('name');

                if (tagsError) {
                    throw tagsError;
                }

                // Get tag usage counts
                const tagUsageCounts = {};
                if (allAssets.length > 0) {
                    allAssets.forEach(asset => {
                        if (asset.tags && Array.isArray(asset.tags)) {
                            asset.tags.forEach(tag => {
                                tagUsageCounts[tag] = (tagUsageCounts[tag] || 0) + 1;
                            });
                        }
                    });
                }

                if (!tags || tags.length === 0) {
                    tagsList.innerHTML = '<div class="no-tags-message">No tags found. Create your first tag above!</div>';
                    return;
                }

                // Display tags
                tagsList.innerHTML = tags.map(tag => `
                    <div class="tag-item">
                        <div class="tag-info">
                            <div class="tag-name">${escapeHtml(tag.name)}</div>
                            ${tag.description ? `<div class="tag-description">${escapeHtml(tag.description)}</div>` : ''}
                        </div>
                        <div class="tag-actions">
                            <span class="tag-usage-count">${tagUsageCounts[tag.name] || 0} assets</span>
                            <button class="btn btn-sm btn-secondary" onclick="editTag(${tag.id}, '${escapeHtml(tag.name)}', '${escapeHtml(tag.description || '')}')">
                                ‚úèÔ∏è Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTag(${tag.id}, '${escapeHtml(tag.name)}', ${tagUsageCounts[tag.name] || 0})">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('‚ùå Error loading tags for management:', error);
                tagsList.innerHTML = '<div class="no-tags-message" style="color: #e74c3c;">Error loading tags. Please try again.</div>';
                showStatus(`Error loading tags: ${error.message}`, 'error');
            }
        }

        async function addNewTag(name, description) {
            try {
                console.log('üè∑Ô∏è Adding new tag:', name);
                
                // Check if tag already exists
                const existingTag = allTags.find(tag => tag.name.toLowerCase() === name.toLowerCase());
                if (existingTag) {
                    throw new Error('A tag with this name already exists');
                }

                const tagData = {
                    name: name.trim(),
                    description: description ? description.trim() : null,
                    created_at: new Date().toISOString()
                };

                const { data, error } = await supabase
                    .from('asset_tags')
                    .insert([tagData])
                    .select();

                if (error) {
                    throw error;
                }

                console.log('‚úÖ Tag added successfully:', data);
                showStatus(`Tag "${name}" added successfully!`, 'success');
                
                // Reload tags in main app and management modal
                await loadTags();
                await loadTagsForManagement();
                
                return data[0];

            } catch (error) {
                console.error('‚ùå Error adding tag:', error);
                showStatus(`Error adding tag: ${error.message}`, 'error');
                throw error;
            }
        }

        function editTag(tagId, currentName, currentDescription) {
            const newName = prompt(`Edit tag name:`, currentName);
            if (newName === null) return; // User cancelled
            
            if (newName.trim() === '') {
                showStatus('Tag name cannot be empty', 'error');
                return;
            }

            const newDescription = prompt(`Edit description (optional):`, currentDescription || '');
            if (newDescription === null) return; // User cancelled

            updateTag(tagId, newName.trim(), newDescription ? newDescription.trim() : null);
        }

        async function updateTag(tagId, newName, newDescription) {
            try {
                console.log('‚úèÔ∏è Updating tag:', tagId, newName);

                // Check if new name conflicts with existing tags (excluding current tag)
                const existingTag = allTags.find(tag => tag.id !== tagId && tag.name.toLowerCase() === newName.toLowerCase());
                if (existingTag) {
                    throw new Error('A tag with this name already exists');
                }

                const { error } = await supabase
                    .from('asset_tags')
                    .update({
                        name: newName,
                        description: newDescription
                    })
                    .eq('id', tagId);

                if (error) {
                    throw error;
                }

                console.log('‚úÖ Tag updated successfully');
                showStatus(`Tag updated successfully!`, 'success');
                
                // Reload tags in main app and management modal
                await loadTags();
                await loadTagsForManagement();

            } catch (error) {
                console.error('‚ùå Error updating tag:', error);
                showStatus(`Error updating tag: ${error.message}`, 'error');
            }
        }

        async function deleteTag(tagId, tagName, usageCount) {
            const confirmMessage = usageCount > 0 
                ? `Are you sure you want to delete the tag "${tagName}"?\n\nThis tag is currently used by ${usageCount} asset(s). It will be removed from all assets.\n\nThis action cannot be undone.`
                : `Are you sure you want to delete the tag "${tagName}"?\n\nThis action cannot be undone.`;

            if (!confirm(confirmMessage)) {
                return;
            }

            try {
                console.log('üóëÔ∏è Deleting tag:', tagId, tagName);
                showStatus('Deleting tag...', 'info');

                // Delete from asset_tags table
                const { error } = await supabase
                    .from('asset_tags')
                    .delete()
                    .eq('id', tagId);

                if (error) {
                    throw error;
                }

                // If tag was in use, we should update assets to remove this tag
                if (usageCount > 0) {
                    console.log('üîÑ Removing tag from assets...');
                    
                    // Get assets that use this tag
                    const assetsWithTag = allAssets.filter(asset => 
                        asset.tags && asset.tags.includes(tagName)
                    );

                    // Update each asset to remove the tag
                    for (const asset of assetsWithTag) {
                        const updatedTags = asset.tags.filter(tag => tag !== tagName);
                        
                        const { error: updateError } = await supabase
                            .from('assets')
                            .update({ tags: updatedTags })
                            .eq('id', asset.id);

                        if (updateError) {
                            console.warn(`Warning: Could not remove tag from asset ${asset.id}:`, updateError);
                        }
                    }
                }

                console.log('‚úÖ Tag deleted successfully');
                showStatus(`Tag "${tagName}" deleted successfully!`, 'success');
                
                // Reload everything
                await loadTags();
                await loadAssets();
                await loadTagsForManagement();

            } catch (error) {
                console.error('‚ùå Error deleting tag:', error);
                showStatus(`Error deleting tag: ${error.message}`, 'error');
            }
        }

        // Handle add tag form submission
        document.addEventListener('DOMContentLoaded', function() {
            const addTagForm = document.getElementById('addTagForm');
            if (addTagForm) {
                addTagForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const nameInput = document.getElementById('tagName');
                    const descriptionInput = document.getElementById('tagDescription');
                    
                    const name = nameInput.value.trim();
                    const description = descriptionInput.value.trim();
                    
                    if (!name) {
                        showStatus('Tag name is required', 'error');
                        return;
                    }

                    try {
                        await addNewTag(name, description);
                        
                        // Clear form on success
                        nameInput.value = '';
                        descriptionInput.value = '';
                        
                    } catch (error) {
                        // Error already handled in addNewTag function
                    }
                });
            }

            // Close modal when clicking outside
            const tagModal = document.getElementById('tagManagementModal');
            if (tagModal) {
                tagModal.addEventListener('click', function(e) {
                    if (e.target === tagModal) {
                        closeTagManagement();
                    }
                });
            }

            // Close asset tag editor modal when clicking outside
            const assetTagEditorModal = document.getElementById('assetTagEditorModal');
            if (assetTagEditorModal) {
                assetTagEditorModal.addEventListener('click', function(e) {
                    if (e.target === assetTagEditorModal) {
                        closeAssetTagEditor();
                    }
                });
            }
        });

        async function deleteAsset(assetId) {
            if (!isAdmin) {
                showStatus('Access denied. Admin privileges required.', 'error');
                return;
            }

            const asset = allAssets.find(a => a.id === assetId);
            if (!asset) {
                showStatus('Asset not found.', 'error');
                return;
            }

            const confirmMessage = `Are you sure you want to delete "${asset.name}"?\n\nThis action cannot be undone.`;
            if (!confirm(confirmMessage)) {
                return;
            }

            try {
                console.log(`üóëÔ∏è Deleting asset: ${asset.name} (ID: ${assetId})`);
                showStatus('Deleting asset...', 'info');

                // Step 1: Delete from database first
                console.log('üóëÔ∏è Removing database record...');
                const { error: dbError } = await supabase
                    .from('assets')
                    .delete()
                    .eq('id', assetId);

                if (dbError) {
                    console.error('‚ùå Database deletion error:', dbError);
                    throw new Error(`Failed to delete from database: ${dbError.message}`);
                }

                console.log('‚úÖ Database record deleted');

                // Step 2: Delete from storage (extract file path from URL)
                if (asset.file_url) {
                    try {
                        console.log('üóëÔ∏è Removing file from storage...');
                        console.log('üìÑ File URL:', asset.file_url);
                        
                        // Extract file path from the storage URL
                        let filePath = null;
                        
                        // Handle different URL formats
                        if (asset.file_url.includes('/storage/v1/object/public/assets/')) {
                            filePath = asset.file_url.split('/storage/v1/object/public/assets/')[1];
                        } else if (asset.file_url.includes('/object/public/assets/')) {
                            filePath = asset.file_url.split('/object/public/assets/')[1];
                        } else if (asset.file_url.includes('assets/')) {
                            // Fallback: get everything after 'assets/'
                            const parts = asset.file_url.split('assets/');
                            if (parts.length > 1) {
                                filePath = parts[parts.length - 1];
                            }
                        }
                        
                        if (filePath) {
                            console.log('üìÇ Extracted file path:', filePath);
                            
                            const { error: storageError } = await supabase.storage
                                .from('assets')
                                .remove([filePath]);

                            if (storageError) {
                                console.warn('‚ö†Ô∏è Storage deletion warning:', storageError);
                                // Don't throw error for storage issues - database deletion is more important
                                console.log('‚úÖ Asset deleted (storage cleanup had issues but database cleaned)');
                            } else {
                                console.log('‚úÖ File removed from storage');
                            }
                        } else {
                            console.warn('‚ö†Ô∏è Could not extract file path from URL for storage cleanup');
                        }
                    } catch (storageError) {
                        console.warn('‚ö†Ô∏è Storage cleanup error:', storageError);
                        // Don't fail the whole operation for storage issues
                    }
                }

                // Step 3: Update local state and UI
                allAssets = allAssets.filter(a => a.id !== assetId);
                
                // Re-render the current view
                const filteredAssets = getFilteredAssets();
                displayAssets(filteredAssets);
                
                console.log('‚úÖ Asset deleted successfully');
                showStatus(`Asset "${asset.name}" deleted successfully!`, 'success');

            } catch (error) {
                console.error('‚ùå Error deleting asset:', error);
                showStatus(`Error deleting asset: ${error.message}`, 'error');
                
                // Reload assets to ensure UI is in sync with database
                setTimeout(() => {
                    loadAssets();
                }, 2000);
            }
        }

        // Toggle auth (legacy function)
        function toggleAuth() {
            if (currentUser) {
                signOut();
            } else {
                showSignInModal();
            }
        }
    </script>
</body>
</html>
